var action=function(){"use strict";var e={eventMe:function(t){var n=t;return n.emitterId=Math.ceil(1e4*Math.random()),n.eventStore={},n.emit=function(t,n,o){var r,c,i=this,a="undefined"!=typeof o&&o;if(r=a?i.eventStore[t]:e.eventStore[t],"undefined"!=typeof r)for(c=0;c<r.length;c++)"undefined"!=typeof r[c].scope?r[c].call.apply(r[c].scope,[n,i.emitterId]):r[c].call(n,i.emitterId),r[c].once&&i.silence(t,r[c].call,!0,a)},n.emitLocal=function(e,t){var n=this;n.emit(e,t,!0)},n.listen=function(t,n,o,r,c){var i,a,l,s=this,f=!0,d=t,u=n,p=o,y=c,v=r;if("object"==typeof t&&(d=t.eventName,u=t.handler,p=t.scope,v=t.once,y=t.local),a="undefined"!=typeof y&&y?s.eventStore[t]:e.eventStore[t],l="undefined"!=typeof y&&y?s:e,"undefined"!=typeof a){for(i=0;i<a.length;i++)if(a[i].call===u&&a[i].once===!1){f=!1;break}f&&"undefined"!=typeof o?a.push({once:!1,call:u,scope:p}):f&&a.push({once:!1,call:u})}else l.eventStore[d]=[],l.eventStore[d].push("undefined"!=typeof o?{once:!1,call:u,scope:p}:{once:!1,call:u})},n.listenLocal=function(e,t,n,o){var r=this;"object"==typeof e?(e.local=!0,r.listen(e)):r.listen({eventName:e,handler:t,scope:n,once:o,local:!0})},n.listenOnce=function(t,n,o,r){var c,i,a,l=this,s=!0,f=t,d=n,u=o,p=r;if("object"==typeof t&&(f=t.eventName,d=t.handler,u=t.scope,p=t.local),"undefined"!=typeof p&&p?(i=l.eventStore[f],a=l):(i=e.eventStore[f],a=e),"undefined"!=typeof i){for(c=0;c<i.length;c++)if(i[c].call===d&&i[c].once===!0){s=!1;break}s&&i.push({once:!0,call:d,scope:u})}else a.eventStore[t]=[],a.eventStore[t].push({once:!0,call:d,scope:u})},n.listenOnceLocal=function(e,t,n){var o=this;"object"==typeof e?(e.local=!0,o.listenLocal(e)):o.listenLocal({eventName:e,handler:t,scope:n,local:!0})},n.silence=function(t,n,o,r,c){var i,a,l=this,s=!1,f=t,d=n,u=o,p=r,y=c;if("object"==typeof t&&(f=t.eventName,d=t.handler,u=t.once,p=t.scope,y=t.local),a="undefined"!=typeof y&&y?l:e,"undefined"!=typeof a.eventStore[f])for(i=0;i<a.eventStore[f].length;i++){if(s=!1,"undefined"==typeof d){a.eventStore[f]=[];break}s="undefined"!=typeof p?"boolean"==typeof u?d===a.eventStore[f][i].call&&p===a.eventStore[f][i].scope&&u===a.eventStore[f][i].once:d===a.eventStore[f][i].call&&p===a.eventStore[f][i].scope:"boolean"==typeof u?d===a.eventStore[f][i].call&&a.eventStore[f][i].once===u:d===a.eventStore[f][i].call,s&&a.eventStore[f].splice(i,1)}},n.silenceLocal=function(e,t,n,o){var r=this;"object"==typeof e?(e.local=!0,r.silence(e)):r.silence({eventName:e,handler:t,once:n,scope:o,local:!0})},n.requiredEvent=function(e,t,n,o){var r,c=this;c._fireMultiple="undefined"!=typeof o?o:!1,"undefined"==typeof c.stateEvents&&(c.stateEvents={}),"undefined"==typeof c._triggeredStateReady&&(c._triggeredStateReady=!1),c.stateEvents[e]=!1,r=c.stateUpdate(e,c.stateEvents),c.listen(e,r,c),c.listen(e,t,n)},n.stateUpdate=function(e,t){var n=e,o=t,r=this;return function(){var e,t=!0;if("undefined"!=typeof o[n]){o[n]=!0;for(e in o)t=t&&o[e];t&&(!r._triggeredStateReady||r._fireMultiple)&&(setTimeout(r.stateReady,100),r._triggeredStateReady=!0)}}},n.stateReady=function(){console.log("ready!")},n.listen("system:trace",function(e){var t=this;t.emitterId===e&&t.emit("system:addTraced",t)},n),"function"==typeof n.init&&n.init.apply(n),n},modelMe:function(t){var n=this,o=n.eventMe({}),r={},c=[];return o.get=function(e){return r[e]},o.set=function(t,n){var o,c=this;if("object"==typeof t)for(o in t)t.hasOwnProperty(o)&&("destroy"!==o&&"fetch"!==o&&"save"!==o&&"function"!=typeof t[o]?("object"==typeof n?(r[t]=Array.isArray(t[o])?[]:{},e.clone(r[t],t[o])):r[o]=t[o],c.emitLocal("attribute:changed",o)):c[o]=t[o]);else"destroy"!==t&&"fetch"!==t&&"save"!==t?("object"==typeof n?(r[t]=Array.isArray(n)?[]:{},e.clone(r[t],n)):r[t]=n,c.emitLocal("attribute:changed",t)):c[t]=n},o.flatten=function(){return r},o.fetch=function(){var t=this,n=t.get("url");"undefined"!=typeof n?$.ajax({type:"get",url:n,success:function(n,o){o&&t.emit("global:error",new e.Error("http","Error in request",t)),t.emit(t.get("dataEvent"),n)},error:function(n,o,r){t.emit("global:error",new e.Error("http","Error in request type: "+o,t,r))}}):t.emit("global:error",new e.Error("http","No URL defined",t))},o.save=function(){var t=this,n=t.get("url"),o=t.get("id"),r="undefined"==typeof o?"post":"put";"undefined"!=typeof n?$.ajax({type:r,url:n+"/"+o,data:t.flatten(),success:function(e){t.clearChanges(),t.set(e),t.emit(t.get("dataEvent"),e)},error:function(){t.emit("global:error",new e.Error("http","Error in request",t))}}):e.emit("global:error",new e.Error("http","No URL defined",t))},o.clearChanges=function(){c=[]},o.getChanges=function(){return c},o.clear=function(){r={}},o.destroy=function(){var e,t=this;setTimeout(function(){},0);for(e in t);},o.set(t),o.listenLocal("attribute:changed",function(e){c.push(e)},this),"function"==typeof o.init&&o.init.apply(o),o},Error:function(e,t,n,o){return{type:e,message:t,createdBy:n,errorObject:o}},clone:function(t,n){var o;for(o in n)n.hasOwnProperty(o)&&("object"==typeof n[o]?(t[o]=Array.isArray(n[o])?[]:{},e.clone(t[o],n[o])):t[o]=n[o])},eventStore:{}};return e=e.eventMe(e),e.listen("global:error",function(e){console.group("An Error occured in an object with emitterid: "+e.createdBy.emitterId),console.log("It was a "+e.type+"error."),"string"==typeof e.errorObject?(console.log("It says: "+e.errorObject),console.log("and: "+e.message)):console.log("It says: "+e.message),console.log("The Whole Enchilada (object that caused this mess):"),console.dir(e.createdBy),"function"==typeof e.createdBy.flatten&&(console.log("Just the Lettuce (attributes):"),console.dir(e.createdBy.flatten())),"object"==typeof e.errorObject&&(console.log("Oh look an Error Object!:"),console.dir(e.errorObject)),console.groupEnd()}),e}(this);