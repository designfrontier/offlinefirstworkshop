var action=function(){"use strict";var e={eventMe:function(t){var n=t;return n.emitterId=Math.ceil(1e4*Math.random()),n.eventStore={},n.emit=function(t,n,o){var r,i,a=this,c="undefined"!=typeof o&&o;if(r=c?a.eventStore[t]:e.eventStore[t],"undefined"!=typeof r)for(i=0;i<r.length;i++)"undefined"!=typeof r[i].scope?r[i].call.apply(r[i].scope,[n,a.emitterId]):r[i].call(n,a.emitterId),r[i].once&&a.silence(t,r[i].call,!0,c)},n.emitLocal=function(e,t){var n=this;n.emit(e,t,!0)},n.listen=function(t,n,o,r,i){var a,c,l,s=this,f=!0,u=t,d=n,p=o,y=i,v=r;if("object"==typeof t&&(u=t.eventName,d=t.handler,p=t.scope,v=t.once,y=t.local),c="undefined"!=typeof y&&y?s.eventStore[t]:e.eventStore[t],l="undefined"!=typeof y&&y?s:e,"undefined"!=typeof c){for(a=0;a<c.length;a++)if(c[a].call===d&&c[a].once===!1){f=!1;break}f&&"undefined"!=typeof o?c.push({once:!1,call:d,scope:p}):f&&c.push({once:!1,call:d})}else l.eventStore[u]=[],l.eventStore[u].push("undefined"!=typeof o?{once:!1,call:d,scope:p}:{once:!1,call:d})},n.listenLocal=function(e,t,n,o){var r=this;"object"==typeof e?(e.local=!0,r.listen(e)):r.listen({eventName:e,handler:t,scope:n,once:o,local:!0})},n.listenOnce=function(t,n,o,r){var i,a,c,l=this,s=!0,f=t,u=n,d=o,p=r;if("object"==typeof t&&(f=t.eventName,u=t.handler,d=t.scope,p=t.local),"undefined"!=typeof p&&p?(a=l.eventStore[f],c=l):(a=e.eventStore[f],c=e),"undefined"!=typeof a){for(i=0;i<a.length;i++)if(a[i].call===u&&a[i].once===!0){s=!1;break}s&&a.push({once:!0,call:u,scope:d})}else c.eventStore[t]=[],c.eventStore[t].push({once:!0,call:u,scope:d})},n.listenOnceLocal=function(e,t,n){var o=this;"object"==typeof e?(e.local=!0,o.listenLocal(e)):o.listenLocal({eventName:e,handler:t,scope:n,local:!0})},n.silence=function(t,n,o,r,i){var a,c,l=this,s=!1,f=t,u=n,d=o,p=r,y=i;if("object"==typeof t&&(f=t.eventName,u=t.handler,d=t.once,p=t.scope,y=t.local),c="undefined"!=typeof y&&y?l:e,"undefined"!=typeof c.eventStore[f])for(a=0;a<c.eventStore[f].length;a++){if(s=!1,"undefined"==typeof u){c.eventStore[f]=[];break}s="undefined"!=typeof p?"boolean"==typeof d?u===c.eventStore[f][a].call&&p===c.eventStore[f][a].scope&&d===c.eventStore[f][a].once:u===c.eventStore[f][a].call&&p===c.eventStore[f][a].scope:"boolean"==typeof d?u===c.eventStore[f][a].call&&c.eventStore[f][a].once===d:u===c.eventStore[f][a].call,s&&c.eventStore[f].splice(a,1)}},n.silenceLocal=function(e,t,n,o){var r=this;"object"==typeof e?(e.local=!0,r.silence(e)):r.silence({eventName:e,handler:t,once:n,scope:o,local:!0})},n.requiredEvent=function(e,t,n,o){var r,i=this;i._fireMultiple="undefined"!=typeof o?o:!1,"undefined"==typeof i.stateEvents&&(i.stateEvents={}),"undefined"==typeof i._triggeredStateReady&&(i._triggeredStateReady=!1),i.stateEvents[e]=!1,r=i.stateUpdate(e,i.stateEvents),i.listen(e,t,n),i.listen(e,r,i)},n.stateUpdate=function(e,t){var n=e,o=t,r=this;return function(){var e,t=!0;if("undefined"!=typeof o[n]){o[n]=!0;for(e in o)t=t&&o[e];t&&(!r._triggeredStateReady||r._fireMultiple)&&(setTimeout(r.stateReady.apply(r),100),r._triggeredStateReady=!0)}}},n.stateReady=function(){console.log("ready!")},n.listen("system:trace",function(t){var n=this;n.emitterId===t&&(e.traced=n)},n),"function"==typeof n.init&&n.init.apply(n),n},modelMe:function(t){var n=this,o=n.eventMe({}),r={},i=[];return o.super={},o.get=function(e){return r[e]},o.set=function(t,n){var o,i=this;if("object"==typeof t)for(o in t)t.hasOwnProperty(o)&&("destroy"!==o&&"fetch"!==o&&"save"!==o&&"function"!=typeof t[o]?("object"==typeof n?(r[t]=Array.isArray(t[o])?[]:{},e.clone(r[t],t[o])):r[o]=t[o],i.emitLocal("attribute:changed",o)):("function"==typeof i[o]&&(i.super[o]=i[o].bind(i)),i[o]=t[o]));else"destroy"!==t&&"fetch"!==t&&"save"!==t?("object"==typeof n?(r[t]=Array.isArray(n)?[]:{},e.clone(r[t],n)):r[t]=n,i.emitLocal("attribute:changed",t)):("function"==typeof i[t]&&(i.super[t]=i[t].bind(i)),i[t]=n)},o.flatten=function(){return r},o.fetch=function(t,n,o){var r=this,i=r.get("url"),a=e.useLocalCache;"undefined"!=typeof i?a?window.localforage.getItem(window.btoa(r.get("url")),function(e){null===e?r.ajaxGet(t,function(e){var t=e,n=r.get("url");window.localforage.setItem(window.btoa(n),t,function(){console.log("data done")})}):r.emit(r.get("dataEvent"),e)}):r.ajaxGet(t,n):(r.emit("global:error",new e.Error("http","No URL defined",r)),"function"==typeof o&&o.apply(r))},o.ajaxGet=function(t,n){var o=this,r=o.get("url");$.ajax({type:"get",url:r,success:function(r,i){"success"!==i&&o.emit("global:error",new e.Error("http","Error in request",o)),o.emit(o.get("dataEvent"),r),"string"==typeof t?o.set(t,r):o.set(r),"function"==typeof n&&n.apply(o,[r])},error:function(t,n,r){o.emit("global:error",new e.Error("http","Error in request type: "+n,o,r))}})},o.save=function(){var t=this,n=t.get("url"),o=t.get("id"),r="undefined"==typeof o?"post":"put";"undefined"!=typeof n?$.ajax({type:r,url:n+"/"+o,data:t.flatten(),success:function(e){t.clearChanges(),t.set(e),t.emit(t.get("dataEvent"),e)},error:function(){t.emit("global:error",new e.Error("http","Error in request",t))}}):e.emit("global:error",new e.Error("http","No URL defined",t))},o.clearChanges=function(){i=[]},o.getChanges=function(){return i},o.clear=function(){r={}},o.destroy=function(){var e,t=this;setTimeout(function(){},0);for(e in t);},o.set(t),o.listenLocal("attribute:changed",function(e){i.push(e)},this),"function"==typeof o.init&&o.init.apply(o),o},Error:function(e,t,n,o){return{type:e,message:t,createdBy:n,errorObject:o}},clone:function(t,n){var o;for(o in n)n.hasOwnProperty(o)&&("object"==typeof n[o]?(t[o]=Array.isArray(n[o])?[]:{},e.clone(t[o],n[o])):t[o]=n[o])},eventStore:{}};return e=e.eventMe(e),e.listen("global:error",function(e){console.group("An Error occured in an object with emitterid: "+e.createdBy.emitterId),console.log("It was a "+e.type+"error."),"string"==typeof e.errorObject?(console.log("It says: "+e.errorObject),console.log("and: "+e.message)):console.log("It says: "+e.message),console.log("The Whole Enchilada (object that caused this mess):"),console.dir(e.createdBy),"function"==typeof e.createdBy.flatten&&(console.log("Just the Lettuce (attributes):"),console.dir(e.createdBy.flatten())),"object"==typeof e.errorObject&&(console.log("Oh look an Error Object!:"),console.dir(e.errorObject)),console.groupEnd()}),e}(this);